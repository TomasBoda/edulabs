{"ast":null,"code":"import _objectSpread from\"/Users/tomasboda/Documents/Workspace/React/edulabs/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/tomasboda/Documents/Workspace/React/edulabs/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tomasboda/Documents/Workspace/React/edulabs/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/tomasboda/Documents/Workspace/React/edulabs/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/tomasboda/Documents/Workspace/React/edulabs/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/tomasboda/Documents/Workspace/React/edulabs/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/tomasboda/Documents/Workspace/React/edulabs/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/tomasboda/Documents/Workspace/React/edulabs/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React from\"react\";import{withRouter}from\"react-router-dom\";import{setStorageItem,getStorageItem,removeStorageItem,isLogged}from\"../config/Config\";import Api from\"../config/Api\";import Loading from\"../components/Loading\";import Panel from\"../components/Panel\";import Heading from\"../components/Heading\";import Box from\"../components/Box\";import Edit from\"../components/Edit\";import\"../styles/classroom.css\";import Icon from\"../assets/login-icon.svg\";import ProfileIcon from\"../assets/profile-icon.svg\";var Classroom=/*#__PURE__*/function(_React$Component){_inherits(Classroom,_React$Component);var _super=_createSuper(Classroom);function Classroom(){var _this;_classCallCheck(this,Classroom);_this=_super.call(this);_this.state={edit:false,type:\"add-grade\",classroom:{},subject:{},students:[],currentUser:\"\"};_this.loadData=_this.loadData.bind(_assertThisInitialized(_this));_this.loadClassroom=_this.loadClassroom.bind(_assertThisInitialized(_this));_this.loadSubject=_this.loadSubject.bind(_assertThisInitialized(_this));_this.loadStudents=_this.loadStudents.bind(_assertThisInitialized(_this));return _this;}_createClass(Classroom,[{key:\"loadData\",value:function(){var _loadData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:this.loadClassroom();this.loadSubject();this.loadStudents();case 3:case\"end\":return _context.stop();}}},_callee,this);}));function loadData(){return _loadData.apply(this,arguments);}return loadData;}()},{key:\"loadStudents\",value:function(){var _loadStudents=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var token,classroomId,subjectId,call,fetchedStudents,i,add,id,student,grades,average,students;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:token=getStorageItem(\"token\");classroomId=this.props.match.params.classroomId;subjectId=this.props.match.params.id;_context2.next=5;return Api.getTeacherClassroomStudentsBySubject(classroomId,subjectId,token);case 5:call=_context2.sent;if(!call.students){_context2.next=26;break;}fetchedStudents=[];i=0;case 9:if(!(i<call.students.length)){_context2.next=25;break;}add=function add(a,b){return a+b.value;};id=call.students[i].user_id;_context2.next=14;return Api.getTeacherUser(id,token);case 14:student=_context2.sent;_context2.next=17;return Api.getGradesByUserAndSubject(student.user.id,subjectId,token);case 17:grades=_context2.sent;average=grades.grades.reduce(add,0)/grades.grades.length;if(student.user.role===\"student\"){fetchedStudents.push(_objectSpread(_objectSpread({},student.user),{},{grades:grades.grades,average:average}));}students=fetchedStudents;students.sort(function(a,b){return a.lastname.localeCompare(b.lastname);});case 22:i++;_context2.next=9;break;case 25:this.setState({students:students});case 26:case\"end\":return _context2.stop();}}},_callee2,this);}));function loadStudents(){return _loadStudents.apply(this,arguments);}return loadStudents;}()},{key:\"loadClassroom\",value:function(){var _loadClassroom=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var token,classroomId,call;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:token=getStorageItem(\"token\");classroomId=this.props.match.params.classroomId;_context3.next=4;return Api.getClassroom(classroomId,token);case 4:call=_context3.sent;if(call.classroom){console.log(call.classroom);this.setState({classroom:call.classroom});}case 6:case\"end\":return _context3.stop();}}},_callee3,this);}));function loadClassroom(){return _loadClassroom.apply(this,arguments);}return loadClassroom;}()},{key:\"loadSubject\",value:function(){var _loadSubject=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var token,subjectId,call;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:token=getStorageItem(\"token\");subjectId=this.props.match.params.id;_context4.next=4;return Api.getSubject(subjectId,token);case 4:call=_context4.sent;if(call.subject){console.log(call.subject);this.setState({subject:call.subject});}case 6:case\"end\":return _context4.stop();}}},_callee4,this);}));function loadSubject(){return _loadSubject.apply(this,arguments);}return loadSubject;}()},{key:\"componentDidMount\",value:function componentDidMount(){this.loadData();}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{className:\"screen\",id:\"classroom\",children:[/*#__PURE__*/_jsx(Heading,{title:this.state.subject.name+\" - \"+this.state.classroom.name}),/*#__PURE__*/_jsx(Panel,{title:\"Manage your classroom\",text:\"Manage your classroom in one place. Evaluate your student's results and help them get the best out of their skills.\",image:Icon}),this.state.edit?/*#__PURE__*/_jsx(Edit,{type:this.state.type,userId:this.state.currentUser,subjectId:this.props.match.params.id,close:function close(){return _this2.setState({edit:false},function(){return _this2.loadData();});}}):null,/*#__PURE__*/_jsx(\"div\",{className:\"body-panel\",children:this.state.students.map(function(student){return/*#__PURE__*/_jsxs(\"div\",{className:\"student\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"image\",src:ProfileIcon}),/*#__PURE__*/_jsx(\"div\",{className:\"name\",children:student.firstname+\" \"+student.lastname}),/*#__PURE__*/_jsx(\"div\",{className:\"grades\",children:student.grades.length>0?student.grades.map(function(grade){return/*#__PURE__*/_jsxs(\"div\",{className:\"grade\",children:[grade.value.toFixed(1),\"%\"]});}):/*#__PURE__*/_jsx(\"div\",{className:\"message\",style:{display:\"flex\",alignItems:\"center\"},children:\"No grades\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"average\",children:student.average?student.average.toFixed(1)+\"%\":null}),/*#__PURE__*/_jsx(\"div\",{className:\"button\",onClick:function onClick(){return _this2.setState({currentUser:student.id},function(){return _this2.setState({edit:true});});},children:\"Add grade\"})]});})})]});}}]);return Classroom;}(React.Component);export default withRouter(Classroom);","map":{"version":3,"sources":["/Users/tomasboda/Documents/Workspace/React/edulabs/src/app/screens/Classroom.js"],"names":["React","withRouter","setStorageItem","getStorageItem","removeStorageItem","isLogged","Api","Loading","Panel","Heading","Box","Edit","Classroom","state","edit","type","classroom","subject","students","currentUser","loadData","bind","loadClassroom","loadSubject","loadStudents","token","classroomId","props","match","params","subjectId","id","getTeacherClassroomStudentsBySubject","call","fetchedStudents","i","length","add","a","b","value","user_id","getTeacherUser","student","getGradesByUserAndSubject","user","grades","average","reduce","role","push","sort","lastname","localeCompare","setState","getClassroom","console","log","getSubject","name","Icon","map","ProfileIcon","firstname","grade","toFixed","display","alignItems","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { withRouter } from \"react-router-dom\";\n\nimport { setStorageItem, getStorageItem, removeStorageItem, isLogged } from \"../config/Config\";\n\nimport Api from \"../config/Api\";\nimport Loading from \"../components/Loading\";\nimport Panel from \"../components/Panel\";\nimport Heading from \"../components/Heading\";\nimport Box from \"../components/Box\";\nimport Edit from \"../components/Edit\";\n\nimport \"../styles/classroom.css\";\n\nimport Icon from \"../assets/login-icon.svg\";\nimport ProfileIcon from \"../assets/profile-icon.svg\";\n\nclass Classroom extends React.Component {\n\n    state = {\n        edit: false,\n        type: \"add-grade\",\n\n        classroom: {},\n        subject: {},\n        students: [],\n\n        currentUser: \"\"\n    }\n\n    constructor() {\n        super();\n\n        this.loadData = this.loadData.bind(this);\n        this.loadClassroom = this.loadClassroom.bind(this);\n        this.loadSubject = this.loadSubject.bind(this);\n        this.loadStudents = this.loadStudents.bind(this);\n    }\n\n    async loadData() {\n        this.loadClassroom();\n        this.loadSubject();\n        this.loadStudents();\n    }\n\n    async loadStudents() {\n        const token = getStorageItem(\"token\");\n        const classroomId = this.props.match.params.classroomId;\n        const subjectId = this.props.match.params.id;\n\n        const call = await Api.getTeacherClassroomStudentsBySubject(classroomId, subjectId, token);\n\n        if (call.students) {\n            var fetchedStudents = [];\n\n            for (let i = 0; i < call.students.length; i++) {\n                const id = call.students[i].user_id;\n                const student = await Api.getTeacherUser(id, token);\n\n                const grades = await Api.getGradesByUserAndSubject(student.user.id, subjectId, token);\n\n                function add(a, b) {\n                    return a + b.value;\n                }\n\n                const average = grades.grades.reduce(add, 0) / grades.grades.length;\n\n                if (student.user.role === \"student\") {\n                    fetchedStudents.push({\n                        ...student.user,\n                        grades: grades.grades,\n                        average: average\n                    });\n                }\n\n                var students = fetchedStudents;\n                students.sort((a, b) => {\n                    return a.lastname.localeCompare(b.lastname);\n                });\n            }\n\n            this.setState({ students: students });\n        }\n    }\n\n    async loadClassroom() {\n        const token = getStorageItem(\"token\");\n        const classroomId = this.props.match.params.classroomId;\n\n        const call = await Api.getClassroom(classroomId, token);\n\n        if (call.classroom) {\n            console.log(call.classroom)\n            this.setState({ classroom: call.classroom });\n        }\n    }\n\n    async loadSubject() {\n        const token = getStorageItem(\"token\");\n        const subjectId = this.props.match.params.id;\n\n        const call = await Api.getSubject(subjectId, token);\n\n        if (call.subject) {\n            console.log(call.subject)\n            this.setState({ subject: call.subject });\n        }\n    }\n\n    componentDidMount() {\n        this.loadData();\n    }\n\n    render() {\n        return(\n            <div className=\"screen\" id=\"classroom\">\n                <Heading title={this.state.subject.name + \" - \" + this.state.classroom.name} />\n\n                <Panel\n                    title={\"Manage your classroom\"}\n                    text=\"Manage your classroom in one place. Evaluate your student's results and help them get the best out of their skills.\"\n                    image={Icon}\n                />\n\n                {this.state.edit ? (\n                    <Edit\n                        type={this.state.type}\n                        userId={this.state.currentUser}\n                        subjectId={this.props.match.params.id}\n                        close={() => this.setState({ edit: false }, () => this.loadData())}\n                    />\n                ) : null}\n\n                <div className=\"body-panel\">\n                    {this.state.students.map((student) => {\n                        return <div className=\"student\">\n                            <img className=\"image\" src={ProfileIcon} />\n                            <div className=\"name\">{student.firstname + \" \" + student.lastname}</div>\n\n                            <div className=\"grades\">\n                                {student.grades.length > 0 ? (\n                                    student.grades.map((grade) => (\n                                        <div className=\"grade\">{grade.value.toFixed(1)}%</div>\n                                    ))\n                                ) : <div className=\"message\" style={{ display: \"flex\", alignItems: \"center\" }}>No grades</div>}\n                            </div>\n\n                            <div className=\"average\">{student.average ? student.average.toFixed(1) + \"%\" : null}</div>\n                            <div className=\"button\" onClick={() => this.setState({ currentUser: student.id }, () => this.setState({ edit: true }))}>Add grade</div>\n                        </div>\n                    })}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default withRouter(Classroom);"]},"metadata":{},"sourceType":"module"}